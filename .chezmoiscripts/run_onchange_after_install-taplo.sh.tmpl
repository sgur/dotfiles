#!/usr/bin/env bash
# spell-checker: disable

set -e

{{ $taplo := joinPath .chezmoi.homeDir ".local" "share" "lsp-servers" "taplo" -}}
mkdir -p {{ $taplo }}
pushd {{ $taplo }}

os=$(uname -s | tr "[:upper:]" "[:lower:]")
architecture=$(uname -m)

case $os in
linux)
  platform="linux-$architecture"
  ;;
darwin)
  case $architecture in
    arm64)
      platform="darwin-aarch64"
      ;;
    *)
      platform="darwin-$architecture"
      ;;
  esac
  ;;
esac

curl -L "https://github.com/tamasfe/taplo/releases/latest/download/taplo-full-$platform.gz" | gzip -d >taplo

chmod +x taplo
ln -sf "$(pwd)/taplo" {{ joinPath .chezmoi.homeDir ".local" "bin" }}

popd
