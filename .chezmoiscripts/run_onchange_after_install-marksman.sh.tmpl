#!/usr/bin/env bash
# spell-checker: disable

set -e

MARKSMAN=2023-11-20

{{ $marksman := joinPath .chezmoi.homeDir ".local" "share" "lsp-servers" "marksman" -}}
mkdir -p {{ $marksman }}
pushd {{ $marksman }}

os=$(uname -s | tr "[:upper:]" "[:lower:]")
if [ $(uname -m) = "x86_64" ];
then
  arch="x64"
else
  arch="arm64"
fi
case $os in
linux)
  platform="linux-"$arch
  ;;
darwin)
  platform="macos"
  ;;
esac

curl -L -o marksman "https://github.com/artempyanykh/marksman/releases/download/$MARKSMAN/marksman-$platform"

chmod +x marksman
ln -sf "$(pwd)/marksman" {{ joinPath .chezmoi.homeDir ".local" "bin" }}

popd
